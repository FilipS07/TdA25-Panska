name: Build and push to TdA
on:
  push:
    branches:
      - main
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Check Out Repo
        uses: actions/checkout@v3

      - name: Set up Docker Buildx
        uses: docker/setup-buildx-action@v2

      - name: Build
        uses: docker/build-push-action@v6.8.0
        with:
          context: ./
          cache-from: type=gha
          cache-to: type=gha,mode=max
          tags: tda-generic:latest
          outputs: type=docker,dest=/tmp/tda-generic.tar

      - name: Upload to TdA
        uses: Tour-de-App/upload-app@tda-25
        with:
          team_token: eyJhbGciOiJSUzI1NiIsInR5cCIgOiAiSldUIiwia2lkIiA6ICJ2WElqUWxPd0x3OWsyUUZLY0JXWE1qbTN1Y29UZTlkNHVfZW9BeEI0bWk4In0.eyJleHAiOjE3NDY3OTA0MDAsImlhdCI6MTczMzgzMDQwMCwianRpIjoiMGQyNzdiNjItODQ3OS00Mzk2LTg4YjctMWNjMDA1ZGJlZmYxIiwiaXNzIjoiaHR0cHM6Ly9rZXljbG9hay5yZWdpc3RyeS50b3VyZGUuYXBwL3JlYWxtcy90ZGFfdGVhbXMiLCJhdWQiOiJhY2NvdW50Iiwic3ViIjoiODkxOGJkODUtNjc2YS00ZjliLWE1NjEtYjQ3MjU2ZTA0YzdlIiwidHlwIjoiQmVhcmVyIiwiYXpwIjoiYXV0aGZpc2giLCJzaWQiOiIzMWJiNTVjNi1hYzJkLTQ0ODEtYjBjNy05YTY3NmNkMGNiYzciLCJhY3IiOiIxIiwiYWxsb3dlZC1vcmlnaW5zIjpbIi8qIl0sInJlYWxtX2FjY2VzcyI6eyJyb2xlcyI6WyJvZmZsaW5lX2FjY2VzcyIsInVtYV9hdXRob3JpemF0aW9uIiwiZGVmYXVsdC1yb2xlcy10ZGFfdGVhbXMiXX0sInJlc291cmNlX2FjY2VzcyI6eyJhY2NvdW50Ijp7InJvbGVzIjpbIm1hbmFnZS1hY2NvdW50IiwibWFuYWdlLWFjY291bnQtbGlua3MiLCJ2aWV3LXByb2ZpbGUiXX19LCJzY29wZSI6ImVtYWlsIHByb2ZpbGUgb2ZmbGluZV9hY2Nlc3MiLCJlbWFpbF92ZXJpZmllZCI6dHJ1ZSwibmFtZSI6IkZpbGlwIFNjaGF1ZXIiLCJwcmVmZXJyZWRfdXNlcm5hbWUiOiIyM2FzY2hhdWVyZkBzdHVkZW50LnBhbnNrYS5jeiIsImdpdmVuX25hbWUiOiJGaWxpcCIsImZhbWlseV9uYW1lIjoiU2NoYXVlciIsImVtYWlsIjoiMjNhc2NoYXVlcmZAc3R1ZGVudC5wYW5za2EuY3oifQ.CtRR0OGwPjK_G4H67pxQwDhn5jdkHC0Q8YjwfcZwKmlXr5zkIdUJq2oRZZVXVjJuHD_mgFXtR1tj2-xzCu0G-EsPA-E__Ns42U1Jt2oHiQmX6O3nsP7KFYubC7Nmq07Exl3NCXuHJRObKtSGhl6ttEXaMNBT2GEVJYJMNBEYeZn2VUHd_ugy9pvTRfEbkYZI03F0Qsd3vRvJ_GtZeC35KTGPQuA8PglIiOsGRJfRgKmFACo8e3GZ55HgVtP9Qnxvan_BzxzqBseBIE_kk05u2PsP0_gnFrWhBWkKmLq6q36WsiMQoSAsHh9OUsVkhQx8zKHIcYeXMhJPSS2VSd-mag
          image_name: tda-php
          image_path: Dockerfile
